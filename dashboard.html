<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard â€” Ragelite</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#050b14;color:#eaf2ff}
header{padding:20px;border-bottom:1px solid #1f2937}
header a{color:#eaf2ff;text-decoration:none;margin-right:15px;font-weight:bold}
.container{padding:40px}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
.card{background:#0b1b33;padding:24px;border-radius:16px}
</style>
</head>

<body>

<header>
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="create-campaign.html">Create Campaign</a>
  <a href="#" onclick="logout()">Logout</a>
</header>

<div class="container">
  <h1>Dashboard</h1>

  <div class="cards">
    <div class="card"><h3>Campaigns</h3><p>3</p></div>
    <div class="card"><h3>Spend</h3><p>$1,250</p></div>
    <div class="card"><h3>Leads</h3><p>198</p></div>
  </div>
</div>

<!-- âœ… FIREBASE AUTH (ONLY SCRIPT, AT BOTTOM) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  getFirestore,
  doc,
  getDoc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ---------- FIREBASE ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyDDEuW9B7CdfVXslSMvxFBRVPIlcFjHqXs",
  authDomain: "rageauth-174a5.firebaseapp.com",
  projectId: "rageauth-174a5",
  appId: "1:485170234605:web:2cd934b30ab0de678f38e4"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();
const nav = document.getElementById("mobileNav");

/* ---------- AUTH FUNCTIONS ---------- */
window.googleLogin = async () => {
  await signInWithPopup(auth, provider);
  closeAuth();
};

window.emailSignup = (email, password) =>
  createUserWithEmailAndPassword(auth, email, password);

window.emailLogin = (email, password) =>
  signInWithEmailAndPassword(auth, email, password);

window.logout = async () => {
  await signOut(auth);
  window.location.href = "index.html";
};

/* ---------- PAGE DETECTION ---------- */
const isHomePage =
  window.location.pathname.endsWith("index.html") ||
  window.location.pathname === "/";

/* ---------- AUTH STATE ---------- */
onAuthStateChanged(auth, async (user) => {

  /* ðŸ”’ PROTECT DASHBOARD */
  if (!user && !isHomePage) {
    window.location.href = "index.html";
    return;
  }

  /* NOT LOGGED IN */
  if (!user) {
    nav.innerHTML = `
      <button onclick="openAuth('login')" class="nav-btn">Login</button>
      <button onclick="openAuth('signup')" class="primary nav-btn">
        Create Account
      </button>
    `;
    return;
  }

  /* FIRST LOGIN â†’ CREATE USER */
  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    await setDoc(ref, {
      email: user.email,
      createdAt: serverTimestamp(),
      plan: "free"
    });
  }

  /* LOGGED IN NAVBAR */
  if (isHomePage) {
    nav.innerHTML = `
      <span style="color:#22d3ee;font-weight:600">${user.email}</span>
      <button onclick="logout()" class="nav-btn">Logout</button>
      <a href="dashboard.html" class="primary">Dashboard</a>
    `;
  } else {
    nav.innerHTML = `
      <a href="index.html" class="nav-btn">Home</a>
      <button onclick="logout()" class="nav-btn">Logout</button>
    `;
  }
});
</script>

</body>
</html>



